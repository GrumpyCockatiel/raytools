<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">

<head>
    <meta charset="utf-8" />
    <title>RayGrid</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

    <style type="text/css">
        #dataTable table tr:hover td {
            background-color: palegoldenrod;
        }

        .rowNumStyle {
            font-weight: bold;
        }
    </style>

</head>

<body>
    <div class="container">
        <p class="h3">RayGrid Custom Table Grid Control</p>

        <form class="mb-2">
            <div class="row">
                <div class="col-2">
                    <select name="sizeMenu" id="sizeMenu" class="form-control form-select col-2">
                        <option value="50">50 Records</option>
                        <option value="100">100 Records</option>
                        <option value="500">500 Records</option>
                        <option value="0">Empty</option>
                    </select>
                </div>
                <button id="reloadButton" type="button" class="btn btn-primary col-3">Reload Some Random Data</button>
            </div>
        </form>

        <div id="dataTable"></div>

        <p>Random Data generated by <a href="https://my.api.mockaroo.com/employees?key=8578a260">Mockaroo</a></p>
        <div><a href="https://github.com/GrumpyCockatiel/raytools">Download or Clone from github</a></div>
        <div>&copy;2016-2024 by Tag Guillory</div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
        crossorigin="anonymous"></script>
    <script type="module">

        import { RayGrid } from "./raygrid.js";

        const url = "https://my.api.mockaroo.com/employees?key=8578a260";

        var dataTable = null;

        /* onLoad */
        document.addEventListener("DOMContentLoaded", function (event) {

            // define the data table using a parent block element like div
            dataTable = new RayGrid(document.getElementById("dataTable"), {
                keyfield: 'id',
                styleClasses: ['table-bordered', 'table-hover'],
                columns: [
                    { title: "Info", icons: [{ glyph: "info-circle-fill", handler: iconAction, data: "color" }], renderIf: isManager },
                    { field: "firstName", title: "First Name", sort: true },
                    { field: "lastName", title: "LastName", sort: true },
                    { field: "title", title: "Title", sort: false },
                    { field: "email", title: "Email", format: formatHyperlink },
                    { field: "grade", title: "Grade", sort: true },
                    { field: "ssn", title: "SSN", sort: false },
                    { field: "dob", title: "DOB", sort: true, format: (item) => { return new Date(item.dob).toLocaleString('en-CA', { year: 'numeric', month: '2-digit', day: '2-digit' }); } },
                    { title: "Delete", icons: [{ glyph: "trash", handler: deleteRecord, data: "color" }] }
                ],
                rowNumbers: { visible: true, styleClasses: ['rowNumStyle'] },
                pageSize: 11,
                maxPageButtons: 5,
                rowClickHandler: rowAction
            });

            document.getElementById("reloadButton").addEventListener('click', () => { getData(); });

            getData();
        });

        /* get some data */
        async function getData() {

            try {
                await fetch(url).then(response => {
                    if (!response.ok)
                        throw new Error(`Response status: ${response.status}`);
                    return response.json();
                }).then(loadData);
            } catch (error) {
                console.error(error.message);
            }
        }

        /* callback when data is loaded */
        function loadData(json) {
            const len = document.getElementById("sizeMenu").value;
            dataTable.data = json.slice(0, len);
            dataTable.render();
        }

        function formatHyperlink(item) {
            return `<a href="https://www.linkedin.com/">${item.email}</a>`;
        }

        /* row clicked event handler */
        function rowAction(event, item) {
            alert(JSON.stringify(item));
        }

        /* icon clicked event handler */
        function iconAction(event, item) {
            alert(`Favorite Color for item ${item.idx} is ${item.value}`);
            event.stopPropagation();
        }

        /* conditional render */
        function isManager(item) {
            return (item.grade > 3);
        }

        /* icon handler */
        function deleteRecord(event, item) {
            alert(`Delete item ${item.id}`);
            event.stopPropagation();
        }

    </script>

</body>

</html>